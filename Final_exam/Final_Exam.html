<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kobayashi Maru Simulation</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Mono:wght@400;700&family=Great+Vibes&display=swap" rel="stylesheet">
<style>
:root {
  --accent:#35d07f;
  --accent-soft:#35d07f33;
  --text:#dfffea;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{
  height:100%;
  overflow:hidden;
  background:#000;
  font-family:'Roboto Mono',monospace;
  color:var(--text);
}
#stars{
  position:absolute;
  inset:0;
  background:radial-gradient(circle at 50% 50%,#001 0%,#000 70%);
  overflow:hidden;
}
.star{
  position:absolute;
  width:2px;height:2px;
  background:#fff;
  border-radius:50%;
  opacity:.85;
  animation:moveStars 6s linear infinite;
}
@keyframes moveStars{
  0%{transform:translateZ(0) scale(1)}
  100%{transform:translateZ(300px) scale(0)}
}
#hud{
  position:relative;z-index:10;width:92%;max-width:980px;
  margin:5% auto;
  background:linear-gradient(135deg,#0a0f12,#000);
  border:3px solid var(--accent);
  border-radius:22px;
  box-shadow:0 0 40px var(--accent-soft),inset 0 0 40px #000;
  padding:24px 28px;
  display:flex;
  flex-direction:row;
  gap:30px;
}
#main-panel{flex:3;display:flex;flex-direction:column;align-items:center}
#side-panels{flex:1;display:flex;flex-direction:column;gap:24px;align-items:center;justify-content:flex-start}
#header{
  font-family:'Orbitron',sans-serif;
  font-size:1.2rem;
  color:var(--accent);
  border-bottom:2px solid var(--accent);
  padding-bottom:10px;
  margin-bottom:18px;
  text-align:center;
  letter-spacing:1px;
}
#message{
  min-height:150px;
  font-size:1.06rem;
  line-height:1.65;
  text-shadow:0 0 10px var(--accent-soft);
  margin-bottom:18px;
}
#buttons{display:flex;flex-wrap:wrap;justify-content:center;gap:14px}
button{
  background:linear-gradient(90deg,var(--accent-soft),transparent);
  border:1px solid var(--accent);
  color:var(--text);
  padding:10px 22px;
  border-radius:10px;
  font-family:'Orbitron',sans-serif;
  font-size:1rem;
  cursor:pointer;
  transition:.2s ease;
  letter-spacing:.5px;
  text-shadow:0 0 10px var(--accent-soft);
}
button:hover{
  background:var(--accent);
  color:#000;
  box-shadow:0 0 22px var(--accent);
  transform:scale(1.06);
}
.alert-green{--accent:#35d07f;--accent-soft:#35d07f55;--text:#dfffea}
.alert-yellow{--accent:#ffd166;--accent-soft:#ffd16655;--text:#fff6db}
.alert-red{--accent:#ff4b4b;--accent-soft:#ff4b4b55;--text:#ffe5e5}
#alert-controls,#ship-systems{
  border:2px solid var(--accent);
  border-radius:12px;
  padding:12px;
  width:100%;
  text-align:center;
}
#alert-controls h3,#ship-systems h3{
  font-family:'Orbitron',sans-serif;
  font-size:1rem;
  margin-bottom:10px;
  color:var(--accent);
}
.alert-btn{
  display:block;width:100%;margin:6px 0;
  border-radius:8px;font-weight:bold;text-transform:uppercase;
  color:#000;border:none;padding:8px;
  font-family:'Orbitron',sans-serif;letter-spacing:.5px;
}
.green{background-color:#35d07f}
.yellow{background-color:#ffd166}
.red{background-color:#ff4b4b}
#ship-systems button{
  display:block;width:100%;margin:6px 0;border-radius:8px;
  font-family:'Orbitron',sans-serif;padding:8px;
}
#tactical{
  position:relative;width:160px;height:160px;
  border:2px solid var(--accent);border-radius:50%;
  overflow:hidden;margin-top:30px;
}
#sweep{
  position:absolute;width:50%;height:2px;top:50%;left:50%;
  transform-origin:left center;
  background:var(--accent);
  animation:sweep 4s linear infinite;
}
@keyframes sweep{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
.blip{position:absolute;width:6px;height:6px;background:var(--accent);border-radius:50%;opacity:0;transition:all 6s linear}
#graduation{
  position:fixed;inset:0;
  display:none;
  align-items:center;justify-content:center;
  background:#000;z-index:1000;
  padding:20px;
}
.certificate{
  position:relative;
  width:95vw;max-width:1100px;
  height:auto;max-height:95vh;
  background:linear-gradient(180deg,#020614 0%,#0b1833 100%);
  border:4px solid #d6b25e;
  border-radius:16px;
  box-shadow:0 0 50px rgba(255,212,122,.3) inset,0 0 50px rgba(74,176,255,.25);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
.certificate::before{
  content:"";
  position:absolute;inset:0;
  background:url('https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Enterprise%20D.jpg') center/contain no-repeat;
  opacity:0.05;
  z-index:0;
}
.cert-frame{
  position:relative;
  z-index:1;
  padding:60px 80px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
}
.cert-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  width:100%;
  max-width:900px;
  margin-bottom:30px;
}
.cert-header img{
  width:120px;
  height:auto;
}
.cert-title{
  font-family:'Orbitron',sans-serif;
  font-size:34px;
  letter-spacing:2px;
  color:#ffd47a;
  text-transform:uppercase;
}
.cert-subtitle{
  margin-top:6px;
  font-size:18px;
  color:#4ab0ff;
  letter-spacing:1px;
}
.cert-body{
  max-width:900px;
  font-family:'Roboto Mono',monospace;
  font-size:16px;
  line-height:1.7;
  color:#eaeaea;
  margin:36px auto 10px;
}
.cert-name{
  font-size:22px;
  font-weight:bold;
  color:#fff;
}
.cert-assign{
  margin-top:12px;
  font-size:15px;
  color:#ffd47a;
}
.cert-line{
  width:260px;
  height:3px;
  background:linear-gradient(90deg,#ffd47a,#4ab0ff);
  border-radius:2px;
  margin:40px auto;
  box-shadow:0 0 16px rgba(74,176,255,.35);
}
.cert-sigs{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:18px;
  max-width:820px;
  margin:34px auto 0;
}
.sig{
  padding-top:10px;
  border-top:2px solid #ffd47a;
}
.sig-name{
  font-family:'Great Vibes',cursive;
  font-size:28px;
  color:#ffd47a;
}
.sig-title{
  margin-top:-4px;
  font-size:12px;
  color:#9ccfff;
  letter-spacing:.5px;
}
</style>
</head>
<body class="alert-green">
<div id="stars"></div>
<div id="hud">
  <div id="main-panel">
    <div id="header">KOBAYASHI MARU — STARFLEET SIMULATION</div>
    <div id="message">Initializing simulation...</div>
    <div id="buttons"></div>
    <div id="tactical"><div id="sweep"></div></div>
  </div>
  <div id="side-panels">
    <div id="alert-controls">
      <h3>Alert Controls</h3>
      <button class="alert-btn green" onclick="setAlert('green')">Green Alert</button>
      <button class="alert-btn yellow" onclick="setAlert('yellow')">Yellow Alert</button>
      <button class="alert-btn red" onclick="setAlert('red')">Red Alert</button>
    </div>
    <div id="ship-systems">
      <h3>Ship Systems</h3>
      <button onclick="systemAction('Shields raised to full.')">Raise Shields</button>
      <button onclick="systemAction('Power diverted to engines.')">Divert Power</button>
      <button onclick="systemAction('Long-range scan initiated.')">Scan Area</button>
      <button onclick="systemAction('Opening hailing frequencies.')">Open Hailing</button>
    </div>
  </div>
</div>

<div id="graduation">
  <div class="certificate">
    <div class="cert-frame">
      <div class="cert-header">
        <img src="https://upload.wikimedia.org/wikipedia/commons/3/3c/Starfleet_delta_insignia.svg">
        <div>
          <div class="cert-title">Starfleet Academy</div>
          <div class="cert-subtitle">Certificate of Graduation</div>
        </div>
        <img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/bea3b8f5-7eaf-430d-a7e1-b4faebd7d919/d7ukvnj-82e953e4-7cfc-426d-8b9c-084ebc249516.png">
      </div>
      <div class="cert-body">
        Be it known that, having completed the rigorous academic, operational and leadership requirements of Starfleet Academy,
        and having upheld the solemn ideals of the United Federation of Planets,
        <span id="certName" class="cert-name"></span> is hereby honored as a graduate and is elevated to the commissioned rank of Ensign in Starfleet.
      </div>
      <div class="cert-assign" id="certAssign"></div>
      <div class="cert-line"></div>
      <div class="cert-sigs">
        <div class="sig">
          <div class="sig-name">Alynna Necheyev</div>
          <div class="sig-title">Admiral – Commandant, Starfleet Academy</div>
        </div>
        <div class="sig">
          <div class="sig-name">Kathryn Janeway</div>
          <div class="sig-title">Captain – Command Instructor</div>
        </div>
        <div class="sig">
          <div class="sig-name">Jean-Luc Picard</div>
          <div class="sig-title">Captain – Dean of Students</div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
const DATA_URL = "Kobayashi_Maru.json";
const messageBox = document.getElementById('message');
const buttonsBox = document.getElementById('buttons');
const stars = document.getElementById('stars');
const tactical = document.getElementById('tactical');
const grad = document.getElementById('graduation');
const certName = document.getElementById('certName');
const certAssign = document.getElementById('certAssign');
let scenes = {};
let currentAlert = 'green';
let contactsPresent = false;
const metrics = { aggression: 0, caution: 0, empathy: 0, diplomacy: 0, protocol: 0 };
const departments = ["Command", "Science", "Engineering", "Medical", "Security", "Tactical"];
const ships = [
  { name: "Enterprise", reg: "NCC-1701-E" },
  { name: "Voyager", reg: "NCC-74656" },
  { name: "Defiant", reg: "NX-74205" },
  { name: "Excelsior", reg: "NCC-2000" },
  { name: "Titan", reg: "NCC-80102" }
];
const debriefs = {
  rescue: [
    "Cadet chose to cross the Neutral Zone and mount a daring rescue of the Kobayashi Maru, defying regulations in favor of compassion and courage. The maneuver displayed initiative and decisive command presence under extreme duress.",
    "Despite explicit treaty boundaries, the cadet authorized a rescue attempt, prioritizing lives over politics. Tactical execution was bold, though the decision carried significant diplomatic risk.",
    "Cadet disregarded standing orders to engage in a rescue operation, coordinating shields and tractor beam maneuvers under heavy fire. The choice reflected an unshakable moral compass aligned with Starfleet’s humanitarian values."
  ],
  treaty: [
    "Cadet adhered strictly to the Treaty of Algeron, declining to enter the Neutral Zone despite distress signals. This decision showcased disciplined command judgment and commitment to Federation law.",
    "Demonstrating restraint under pressure, the cadet refused to violate diplomatic boundaries. The analysis reflects an understanding that long-term peace often outweighs immediate gain.",
    "By upholding Federation protocol and refraining from unauthorized entry, the cadet avoided potential escalation with Klingon forces—exemplifying sound political awareness and discipline."
  ],
  partial: [
    "Cadet initiated a rescue attempt with calculated precision, managing partial recovery before enemy reinforcements arrived. The response balanced empathy with survival instinct, earning commendation for measured command.",
    "Despite overwhelming opposition, the cadet executed a limited extraction operation, securing some survivors before withdrawal. The decision reflected strong situational awareness and crisis management.",
    "A valiant effort yielded partial success. The cadet demonstrated resourcefulness under fire and ensured the survival of several crew members through tactical withdrawal."
  ],
  negotiation: [
    "Cadet sought peaceful resolution through communication with Klingon forces, employing diplomacy under tension. Though unconventional, the approach averted greater loss and demonstrated mastery of nonviolent command.",
    "Through precise negotiation and cultural understanding, the cadet managed to defuse hostilities temporarily. The action reflected an advanced grasp of Klingon honor and diplomacy protocols.",
    "Choosing negotiation over aggression, the cadet used reason and empathy to engage the opposing commander. While success was limited, the effort reflected the Federation’s highest ideals."
  ],
  withdrawal: [
    "Cadet evaluated the tactical imbalance and chose strategic withdrawal, prioritizing crew safety and long-term mission capability. The decision reflected clear judgment under duress.",
    "By ordering retreat in the face of overwhelming odds, the cadet preserved vessel and crew integrity—demonstrating leadership rooted in pragmatism and foresight.",
    "Recognizing the futility of engagement, the cadet executed a controlled withdrawal, avoiding needless loss of life while maintaining discipline and composure."
  ]
};
for (let i = 0; i < 220; i++) {
  const s = document.createElement('div');
  s.className = 'star';
  s.style.top = Math.random() * 100 + '%';
  s.style.left = Math.random() * 100 + '%';
  s.style.animationDelay = (Math.random() * 5) + 's';
  s.style.opacity = Math.random();
  stars.appendChild(s);
}
function typeText(txt, done) {
  messageBox.textContent = "";
  let i = 0;
  (function step() {
    if (i < txt.length) {
      messageBox.textContent += txt.charAt(i++);
      setTimeout(step, 22);
    } else if (done) done();
  })();
}
function recordMetrics(choice) {
  const text = choice.toLowerCase();
  if (/attack|fire|engage|rescue/.test(text)) metrics.aggression++;
  if (/retreat|withdraw|stand down/.test(text)) metrics.caution++;
  if (/hail|communicate|negotiate/.test(text)) metrics.diplomacy++;
  if (/regulation|order|protocol/.test(text)) metrics.protocol++;
  if (/rescue|save|help/.test(text)) metrics.empathy++;
}
function determineDebrief() {
  const { aggression, caution, empathy, diplomacy, protocol } = metrics;
  let key;
  if (diplomacy > aggression && diplomacy > caution) key = "negotiation";
  else if (aggression > empathy && aggression > caution) key = "rescue";
  else if (empathy > aggression && empathy >= diplomacy) key = "partial";
  else if (protocol > empathy && protocol >= aggression) key = "treaty";
  else key = "withdrawal";
  const options = debriefs[key];
  return options[Math.floor(Math.random() * options.length)];
}
function showGraduation() {
  const dept = departments[Math.floor(Math.random() * departments.length)];
  const ship = ships[Math.floor(Math.random() * ships.length)];
  const params = new URLSearchParams(window.location.search);
  const cadet = params.get("name") || "Unnamed Cadet";
  document.getElementById("hud").style.display = "none";
  certName.textContent = cadet;
  certAssign.textContent = `Assignment: ${dept} Division, USS ${ship.name} (${ship.reg})`;
  grad.style.display = "flex";
}
function showScene(id) {
  const sc = scenes[id];
  if (!sc) {
    messageBox.textContent = `Scene '${id}' not found.`;
    buttonsBox.innerHTML = "";
    return;
  }
  buttonsBox.innerHTML = "";
  typeText(sc.text || "", () => {
    (sc.options || []).forEach(o => {
      const b = document.createElement('button');
      b.textContent = o.label;
      b.onclick = () => {
        recordMetrics(o.label);
        if (o.label === "End Simulation") {
          const d = determineDebrief();
          typeText(d, () => {
            const endBtn = document.createElement("button");
            endBtn.textContent = "Proceed to Graduation";
            endBtn.onclick = showGraduation;
            buttonsBox.innerHTML = "";
            buttonsBox.appendChild(endBtn);
          });
        } else {
          showScene(o.next);
        }
      };
      buttonsBox.appendChild(b);
    });
  });
}
async function init() {
  try {
    messageBox.textContent = "Loading mission data...";
    const res = await fetch(DATA_URL, { cache: 'no-store' });
    const data = await res.json();
    scenes = {};
    (Array.isArray(data) ? data : (data.scenes || [])).forEach(s => { if (s && s.id) scenes[s.id] = s; });
    showScene('start');
  } catch {
    messageBox.textContent = "Error loading mission data.";
  }
}
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>

