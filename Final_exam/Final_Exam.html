<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kobayashi Maru Simulation</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #ffd47a;
  --blue: #4ab0ff;
  --green: #00cc66;
  --red: #cc0033;
  --dark-blue: #001933;
  --black: #000;
  --text: #f3f3f3;
}

html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: var(--black);
  font-family: 'Roboto', sans-serif;
  color: var(--text);
  overflow-x: hidden;
}

@font-face {
  font-family: 'Final Frontier';
  src: url('https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Final_Frontier.ttf') format('truetype');
}

.page-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 34pt;
  color: var(--gold);
  text-align: center;
  margin: 15px 0 8px;
}

#loginScreen {
  position: relative;
  height: 100vh;
  width: 100%;
  background: url("Starfleet Academy - San Francisco.gif") no-repeat center center fixed;
  background-size: cover;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 0;
  opacity: 1;
  transition: opacity 3s ease-out;
}

#loginScreen.fade-out {
  opacity: 0;
}

.lcars-top, .lcars-bottom {
  position: absolute;
  left: 0;
  width: 100%;
  background: var(--gold);
  font-family: 'Final Frontier', sans-serif;
  font-size: 24pt;
  color: #001933;
  display: flex;
  align-items: center;
  justify-content: center;
  text-transform: uppercase;
  font-weight: bold;
}

.lcars-top {
  top: 0;
  height: 50px;
  border-bottom-left-radius: 50px;
}

.lcars-bottom {
  bottom: 0;
  height: 40px;
  border-top-left-radius: 50px;
}

.glass-panel {
  background: rgba(30, 40, 60, 0.125);
  backdrop-filter: blur(20px) saturate(180%);
  border: 2px solid var(--gold);
  border-radius: 18px;
  box-shadow: 0 0 25px rgba(255, 212, 122, 0.4), inset 0 0 35px rgba(74, 176, 255, 0.2);
  padding: 40px 50px;
  width: 500px;
  text-align: center;
  animation: panelFadeIn 1.4s ease-in-out;
  color: var(--text);
}

@keyframes panelFadeIn {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}

.login-subtext {
  font-size: 13pt;
  letter-spacing: 1px;
  color: #ffffff;
  text-shadow: 0 0 8px rgba(74, 176, 255, 0.9);
  margin-bottom: 18px;
}

.lcars-divider {
  height: 4px;
  width: 80%;
  margin: 0 auto 20px;
  background: linear-gradient(to right, var(--gold), var(--blue));
  border-radius: 2px;
}

label {
  display: block;
  color: #ffffff;
  font-size: 14pt;
  margin-bottom: 6px;
  text-align: left;
}

label[for="cadetName"] {
  text-align: center;
  width: 100%;
  display: block;
}

input, select {
  width: 100%;
  padding: 12px;
  margin-bottom: 18px;
  background: rgba(0, 0, 0, 0.45);
  border: 1px solid var(--blue);
  color: #ffffff;
  font-size: 14pt;
  border-radius: 6px;
}

#cadetName {
  width: 50%;
  margin: 0 auto 18px;
  display: block;
}

::placeholder {
  color: rgba(255, 255, 255, 0.7);
}

button {
  font-family: 'Orbitron', sans-serif;
  background: linear-gradient(to bottom, #003366, #001933);
  border: 2px solid var(--gold);
  color: var(--gold);
  font-size: 14pt;
  border-radius: 10px;
  padding: 10px 20px;
  margin: 8px;
  cursor: pointer;
  box-shadow: inset 0 6px 8px rgba(255, 255, 255, 0.06), inset 0 -6px 10px rgba(0, 0, 0, 0.6), 0 6px 12px rgba(0, 0, 0, 0.9);
  transition: transform .2s, box-shadow .2s;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: inset 0 6px 10px rgba(255, 255, 255, 0.08), inset 0 -6px 12px rgba(0, 0, 0, 0.7), 0 14px 28px rgba(0, 0, 0, 1);
}

button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.corner-image {
  position: fixed;
  width: 2.5in;
  height: 2.5in;
  object-fit: contain;
  pointer-events: none;
  z-index: 10;
}

.corner-left { top: 10px; left: 10px; }
.corner-right { top: 10px; right: 10px; }

#mainScreen {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  height: 100vh;
  width: 100%;
  text-align: center;
}

#mainScreen .container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 90vh;
  max-height: 90vh;
  padding: 20px 40px;
  box-sizing: border-box;
  overflow: hidden;
  margin-top: 10px;
}

#mainScreen .container p {
  margin: 5px 0;
  font-size: 13pt;
  line-height: 1.4;
}

.department-select-box {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  justify-items: center;
  align-items: center;
  max-width: 700px;
  margin: 0 auto;
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid var(--gold);
  border-radius: 12px;
  padding: 30px;
  box-shadow: 0 0 15px var(--blue);
}

.km-button-box {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 10px;
}

.boxed-scenario {
  background: linear-gradient(145deg, #000814, #001f3f);
  border: 2px solid var(--gold);
  border-radius: 14px;
  padding: 20px 25px;
  margin: 25px auto;
  box-shadow: 0 6px 10px rgba(0, 0, 0, 0.7), inset 0 0 12px rgba(74, 176, 255, 0.25), 0 0 18px rgba(255, 212, 122, 0.3);
  color: var(--text);
  max-width: 950px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.boxed-scenario:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.8), inset 0 0 16px rgba(74, 176, 255, 0.35), 0 0 25px rgba(255, 212, 122, 0.5);
}

.boxed-scenario .training-header-bar {
  background: #d4af37;
  color: #001933;
  padding: 8px 12px;
  border-radius: 10px;
  font-weight: bold;
  text-align: center;
  box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.4);
}

.boxed-scenario h3 {
  margin-top: 15px;
  color: #ffffff;
  text-shadow: 0 0 6px rgba(74, 176, 255, 0.6);
}

.boxed-scenario p {
  margin: 10px 0;
  color: #dcdcdc;
  line-height: 1.5;
}

.best-answer {
  color: limegreen;
  font-weight: bold;
}

#graduation {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: #000;
  z-index: 1000;
  padding: 40px 20px;
}

.certificate {
  position: relative;
  width: min(1100px, 92vw);
  background: #000;
  border: 3px solid #ffd47a;
  border-radius: 20px;
  box-shadow: 0 0 40px rgba(255,212,122,.35), 0 0 60px rgba(74,176,255,.25) inset;
  overflow: hidden;
}

.cert-rails .rail {
  position: absolute;
  background: linear-gradient(90deg, #012244 0%, #001933 60%, #000 100%);
  box-shadow: 0 0 20px rgba(74,176,255,.35);
}

.rail-top { top: 0; left: 0; right: 0; height: 14px; }
.rail-bottom { bottom: 0; left: 0; right: 0; height: 12px; }
.rail-left { top: 0; bottom: 0; left: 0; width: 14px; }
.rail-right { top: 0; bottom: 0; right: 0; width: 12px; }

.cert-inner {
  padding: 48px 56px;
  color: #fff;
  text-align: center;
  font-family: 'Orbitron', sans-serif;
}

.cert-title {
  font-size: 28px;
  letter-spacing: 2px;
  color: #ffd47a;
  text-transform: uppercase;
}

.cert-subtitle {
  margin-top: 6px;
  font-size: 18px;
  color: #4ab0ff;
  letter-spacing: 1px;
}

.cert-name {
  margin-top: 28px;
  font-size: 40px;
  letter-spacing: 1px;
  color: #ffffff;
}

.cert-line {
  width: 260px;
  height: 3px;
  background: linear-gradient(90deg, #ffd47a, #4ab0ff);
  border-radius: 2px;
  margin: 16px auto 0;
  box-shadow: 0 0 16px rgba(74,176,255,.35);
}

.cert-text {
  margin: 26px auto 6px;
  max-width: 820px;
  font-family: 'Roboto Mono', monospace;
  font-size: 16px;
  line-height: 1.7;
  color: #eaeaea;
}

.cert-assign {
  margin-top: 10px;
  font-family: 'Roboto Mono', monospace;
  font-size: 15px;
  color: #ffd47a;
}

.cert-sigs {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 18px;
  max-width: 820px;
  margin: 34px auto 0;
}

.sig { padding-top: 10px; border-top: 2px solid #ffd47a; }
.sig-name {
  font-family: 'Brush Script MT', cursive;
  font-size: 28px;
  color: #ffd47a;
}
.sig-title {
  margin-top: -4px;
  font-size: 12px;
  color: #9ccfff;
  letter-spacing: .5px;
}

.cert-buttons {
  margin: 34px auto 10px;
  display: flex;
  gap: 14px;
  justify-content: center;
}

.cert-buttons button {
  background: linear-gradient(180deg, #003366, #001933);
  border: 2px solid #ffd47a;
  color: #ffd47a;
  padding: 10px 18px;
  border-radius: 10px;
  font-family: 'Orbitron', sans-serif;
  font-size: 14px;
  cursor: pointer;
  transition: transform .2s, box-shadow .2s;
}

.cert-buttons button:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 16px rgba(255,212,122,.35);
}

@media print {
  #hud, #stars { display: none !important; }
  #graduation { position: static; padding: 0; background: #000; }
  .certificate { width: 100%; border: 0; box-shadow: none; border-radius: 0; }
  .cert-buttons { display: none; }
}
  </style>
</head>
<body class="alert-green">
  <div id="stars"></div>
  <div id="hud">
    <div id="main-panel">
      <div id="header">KOBAYASHI MARU — STARFLEET SIMULATION</div>
      <div id="message">Initializing simulation...</div>
      <div id="buttons"></div>
      <div id="tactical"><div id="sweep"></div></div>
    </div>
    <div id="side-panels">
      <div id="alert-controls">
        <h3>Alert Controls</h3>
        <button class="alert-btn green" onclick="setAlert('green')">Green Alert</button>
        <button class="alert-btn yellow" onclick="setAlert('yellow')">Yellow Alert</button>
        <button class="alert-btn red" onclick="setAlert('red')">Red Alert</button>
      </div>
      <div id="ship-systems">
        <h3>Ship Systems</h3>
        <button onclick="systemAction('Shields raised to full.')">Raise Shields</button>
        <button onclick="systemAction('Power diverted to engines.')">Divert Power</button>
        <button onclick="systemAction('Long-range scan initiated.')">Scan Area</button>
        <button onclick="systemAction('Opening hailing frequencies.')">Open Hailing</button>
      </div>
    </div>
  </div>

 <div id="graduation">
  <div class="certificate">
    <div class="cert-rails">
      <div class="rail rail-top"></div>
      <div class="rail rail-left"></div>
      <div class="rail rail-right"></div>
      <div class="rail rail-bottom"></div>
    </div>
    <div class="cert-inner">
      <div class="cert-title">Starfleet Academy</div>
      <div class="cert-subtitle">Certificate of Completion</div>
      <div class="cert-name" id="certName"></div>
      <div class="cert-line"></div>
      <div class="cert-text" id="certText"></div>
      <div class="cert-assign" id="certAssign"></div>
      <div class="cert-sigs">
        <div class="sig">
          <div class="sig-name">C. Pike</div>
          <div class="sig-title">Fleet Captain</div>
        </div>
        <div class="sig">
          <div class="sig-name">J. Kirk</div>
          <div class="sig-title">Command Instructor</div>
        </div>
        <div class="sig">
          <div class="sig-name">Spock</div>
          <div class="sig-title">Academy Dean</div>
        </div>
      </div>
      <div class="cert-buttons">
        <button id="btnDownloadCert">Download Certificate</button>
        <button id="btnCloseCert">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
const DATA_URL = "Kobayashi_Maru.json";
const messageBox = document.getElementById('message');
const buttonsBox = document.getElementById('buttons');
const stars = document.getElementById('stars');
const tactical = document.getElementById('tactical');
const gradScreen = document.getElementById('graduation');
const gradText = document.getElementById('grad-text');
let scenes = {};
let currentAlert = 'green';
let contactsPresent = false;
const metrics = { aggression: 0, caution: 0, empathy: 0, diplomacy: 0, protocol: 0 };
const debriefs = {
  rescue: "Cadet chose to cross the Neutral Zone and mount a rescue of the Kobayashi Maru...",
  treaty: "Cadet declined to violate the Neutral Zone...",
  partial: "Cadet initiated a rescue operation with partial success...",
  negotiation: "Cadet opened communications with Klingon forces...",
  withdrawal: "Cadet assessed the tactical imbalance and elected to withdraw..."
};
const departments = ["Command", "Science", "Engineering", "Medical", "Security", "Tactical"];
const ships = [
  { name: "Enterprise", reg: "NCC-1701-E" },
  { name: "Voyager", reg: "NCC-74656" },
  { name: "Defiant", reg: "NX-74205" },
  { name: "Excelsior", reg: "NCC-2000" },
  { name: "Titan", reg: "NCC-80102" }
];
for (let i = 0; i < 220; i++) {
  const s = document.createElement('div');
  s.className = 'star';
  s.style.top = Math.random() * 100 + '%';
  s.style.left = Math.random() * 100 + '%';
  s.style.animationDelay = (Math.random() * 5) + 's';
  s.style.opacity = Math.random();
  stars.appendChild(s);
}
function toMap(list) {
  const m = {};
  list.forEach(o => { if (o && o.id) m[o.id] = o; });
  return m;
}
function typeText(txt, done) {
  messageBox.textContent = "";
  let i = 0;
  (function step() {
    if (i < txt.length) {
      messageBox.textContent += txt.charAt(i++);
      setTimeout(step, 22);
    } else if (done) done();
  })();
}
function detectAlertFromText(t) {
  const text = t.toLowerCase();
  if (/red alert/.test(text)) return 'red';
  if (/yellow alert/.test(text)) return 'yellow';
  if (/green alert/.test(text)) return 'green';
  return null;
}
function detectContactsFromText(t) {
  const text = t.toLowerCase();
  if (/klingon|enemy ships|warp signatures inbound|decloak/.test(text)) return true;
  return false;
}
function setAlert(level) {
  const body = document.body;
  if (!level || level === currentAlert) return;
  currentAlert = level;
  body.classList.remove('alert-green', 'alert-yellow', 'alert-red');
  body.classList.add(`alert-${level}`);
  systemAction(`Alert level set to ${level.toUpperCase()}.`);
}
function systemAction(text) { typeText(text, null); }
function recordMetrics(choice) {
  const text = choice.toLowerCase();
  if (/attack|fire|engage|rescue/.test(text)) metrics.aggression++;
  if (/retreat|withdraw|stand down/.test(text)) metrics.caution++;
  if (/hail|communicate|negotiate/.test(text)) metrics.diplomacy++;
  if (/regulation|order|protocol/.test(text)) metrics.protocol++;
  if (/rescue|save|help/.test(text)) metrics.empathy++;
}
function determineDebrief() {
  const { aggression, caution, empathy, diplomacy, protocol } = metrics;
  if (diplomacy > aggression && diplomacy > caution) return debriefs.negotiation;
  if (aggression > empathy && aggression > caution) return debriefs.rescue;
  if (empathy > aggression && empathy >= diplomacy) return debriefs.partial;
  if (protocol > empathy && protocol >= aggression) return debriefs.treaty;
  return debriefs.withdrawal;
}
function showGraduation() {
  const dept = departments[Math.floor(Math.random() * departments.length)];
  const ship = ships[Math.floor(Math.random() * ships.length)];
  const params = new URLSearchParams(window.location.search);
  const cadet = params.get("name") || "Unnamed Cadet";
  const species = params.get("species") || "";

  document.getElementById("hud").style.display = "none";
  const grad = document.getElementById("graduation");
  const certName = document.getElementById("certName");
  const certText = document.getElementById("certText");
  const certAssign = document.getElementById("certAssign");

  certName.textContent = cadet;
  certText.textContent = species
    ? "Having demonstrated proficiency in Starfleet Academy’s core disciplines and upheld the principles of the United Federation of Planets, the cadet is hereby recognized for successful completion of the Academy course of study."
    : "Having demonstrated proficiency in Starfleet Academy’s core disciplines and upheld the principles of the United Federation of Planets, the cadet is hereby recognized for successful completion of the Academy course of study.";

  certAssign.textContent = `Assignment: ${dept} Division, USS ${ship.name}, ${ship.reg}`;

  grad.style.display = "flex";

  const dl = document.getElementById("btnDownloadCert");
  const close = document.getElementById("btnCloseCert");
  dl.onclick = () => window.print();
  close.onclick = () => { grad.style.display = "none"; document.getElementById("hud").style.display = "flex"; };
}
function showScene(id) {
  const sc = scenes[id];
  if (!sc) {
    setAlert('red');
    messageBox.textContent = `Scene '${id}' not found.`;
    buttonsBox.innerHTML = "";
    return;
  }
  const inferred = detectAlertFromText(sc.text || "");
  if (inferred) setAlert(inferred);
  if (detectContactsFromText(sc.text || "")) contactsPresent = true;
  buttonsBox.innerHTML = "";
  typeText(sc.text || "", () => {
    (sc.options || []).forEach(o => {
      const b = document.createElement('button');
      b.textContent = o.label;
      b.onclick = () => {
        recordMetrics(o.label);
        if (o.label === "End Simulation") {
          showGraduation();
        } else {
          showScene(o.next);
        }
      };
      buttonsBox.appendChild(b);
    });
    if (sc.id.startsWith("end")) {
      const d = determineDebrief();
      buttonsBox.innerHTML = "";
      const b1 = document.createElement("button");
      b1.textContent = "View Starfleet Debrief";
      b1.onclick = () => {
        typeText(d, () => {
          buttonsBox.innerHTML = "";
          const endBtn = document.createElement("button");
          endBtn.textContent = "End Simulation";
          endBtn.onclick = showGraduation;
          buttonsBox.appendChild(endBtn);
        });
      };
      buttonsBox.appendChild(b1);
    }
  });
}
function spawnBlip() {
  if (!contactsPresent) return;
  const angle = Math.random() * 2 * Math.PI;
  const radius = 80;
  const b = document.createElement('div');
  b.className = 'blip';
  b.style.top = 50 + radius * Math.sin(angle) + '%';
  b.style.left = 50 + radius * Math.cos(angle) + '%';
  tactical.appendChild(b);
  setTimeout(() => {
    b.style.top = '50%';
    b.style.left = '50%';
    b.style.opacity = 1;
  }, 50);
  setTimeout(() => {
    if (b.parentNode === tactical) tactical.removeChild(b);
  }, 9000);
}
setInterval(spawnBlip, 3000);
async function init() {
  try {
    messageBox.textContent = "Loading mission data...";
    const res = await fetch(DATA_URL, { cache: 'no-store' });
    const data = await res.json();
    scenes = toMap(Array.isArray(data) ? data : (data.scenes || []));
    if (!scenes.start) throw new Error('Missing start');
    showScene('start');
  } catch (e) {
    setAlert('red');
    messageBox.textContent = "Error loading mission data.";
    buttonsBox.innerHTML = "";
  }
}
document.addEventListener('DOMContentLoaded', init);
const params = new URLSearchParams(window.location.search);
const cadetName = params.get("name") || "Unnamed Cadet";
const nameField = document.createElement("h2");
nameField.id = "cadetNameDisplay";
nameField.textContent = cadetName;
document.querySelector(".certificate h1").after(nameField);
</script>
</body>
</html>



