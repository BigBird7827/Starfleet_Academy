function loadTraining(dept){
document.getElementById("orientationPage").style.display="none";
document.getElementById("trainingPage").style.display="block";
document.getElementById("trainingDeptTitle").textContent=`${dept} Training`;
document.getElementById("trainingCadetTitle").textContent=`Cadet ${cadetName} of ${homeworld}`;
fetch(trainingFiles[dept]).then(r=>r.json()).then(data=>{
const content=document.getElementById("trainingContent");content.innerHTML="";
if(data.preface){content.innerHTML+=`<p>${data.preface}</p>`;}
if(data.study){data.study.forEach(item=>{
const section=document.createElement("div");section.className="training-section";
let html=`<h3>${item.scenario}</h3><p>${item.summary||""}</p>`;
if(item.answers){html+=`<div class="answers">`;item.answers.forEach(ans=>{
const label=ans.type==="best"?"⭐ Best Answer":"Alternate Answer";
html+=`<div class="answer-block"><p><strong>${label}:</strong> ${ans.text}</p><p><em>Score:</em> ${ans.score}</p><p>${ans.details||""}</p></div>`;
});html+=`</div>`;}
section.innerHTML=html;content.appendChild(section);
});}});
}

function loadLab(dept){
document.getElementById("orientationPage").style.display="none";
document.getElementById("labPage").style.display="block";
document.getElementById("labDeptTitle").textContent=`${dept} Lab`;
document.getElementById("labCadetTitle").textContent=`Cadet ${cadetName} of ${homeworld}`;
fetch(labFiles[dept]).then(r=>r.json()).then(data=>{
const content=document.getElementById("labContent");content.innerHTML="";
if(!(data.lab&&data.lab.length)){content.innerHTML="<p>No lab scenarios found.</p>";return;}
let index=0,score=0;
function renderScenario(){
const item=data.lab[index];
content.innerHTML=`<div class='training-section'><h3>${item.scenario}</h3><p>${item.summary||""}</p></div>`;
const answersDiv=document.createElement("div");answersDiv.className="answers";
item.answers.forEach(ans=>{
const btn=document.createElement("button");
btn.textContent=ans.text;
btn.onclick=()=>evaluate(ans,item);
answersDiv.appendChild(btn);
});
content.appendChild(answersDiv);
}
function evaluate(ans,item){
document.querySelectorAll("#labContent .answers button").forEach(b=>b.disabled=true);
const best=item.answers.find(a=>a.type==="best");
const feedback=document.createElement("div");feedback.className="feedback";
if(ans.type==="best"){feedback.innerHTML=`<strong>Correct.</strong> ${ans.details}`;score+=ans.score;}
else if(ans.type==="alternate"){feedback.innerHTML=`<strong>Acceptable.</strong> ${ans.details}<br><br>The best action would have been:<br><em>${best.text}</em>`;score+=ans.score;}
else{feedback.innerHTML=`<strong>Incorrect.</strong> ${ans.details}<br><br>The correct course of action:<br><em>${best.text}</em>`;}
content.appendChild(feedback);
const next=document.createElement("button");
next.textContent=index<data.lab.length-1?"Next Scenario":"Finish Lab";
next.onclick=()=>{index++;if(index<data.lab.length){renderScenario();}else{content.innerHTML=`<h3>Lab Complete</h3><p>Your final score: ${score}</p>`;}};
content.appendChild(next);
}
renderScenario();
});
}

function loadExam(dept){
document.getElementById("orientationPage").style.display="none";
document.getElementById("examPage").style.display="block";
document.getElementById("examDeptTitle").textContent=`${dept} Exam`;
document.getElementById("examCadetTitle").textContent=`Cadet ${cadetName} of ${homeworld}`;
let classmates=[{name:cadetName,species,s:true,gpa:0,score:0}];
const poolNames=["T'Lor","Dax","Nog","Paris","Vorik","Ro","O'Brien","Leeta","Torres"];
const poolSpecies=["Vulcan","Trill","Ferengi","Human","Vulcan","Bajoran","Human","Bajoran","Klingon"];
for(let i=0;i<9;i++){classmates.push({name:poolNames[i],species:poolSpecies[i],s:false,gpa:(Math.random()*1.6+2.4).toFixed(2),score:0});}
const table=document.getElementById("rankingTable");
function updateRankings(){
classmates.sort((a,b)=>b.gpa-a.gpa);
table.innerHTML=classmates.map((c,i)=>`<tr class='${c.s?"highlight":""}'><td>${i+1}.</td><td>${c.s?"You":c.name}</td><td>${parseFloat(c.gpa).toFixed(2)}</td></tr>`).join("");
}
updateRankings();
fetch(trainingFiles[dept]).then(r=>r.json()).then(data=>{
const questions=data.study.slice(0,15);
let index=0,total=0;
const content=document.getElementById("examContent");
function renderQuestion(){
const q=questions[index];
content.innerHTML=`<div class='training-section'><h3>${q.scenario}</h3><p>${q.summary||""}</p></div>`;
const answersDiv=document.createElement("div");answersDiv.className="answers";
let allAnswers=[...q.answers];
if(allAnswers.length<5){allAnswers.push({text:"Reroute main deflector through EPS grid.",score:0,type:"wrong",details:"This course of action would destabilize the system."});allAnswers.push({text:"Ignore the situation and await orders.",score:0,type:"wrong",details:"Inaction in crisis situations is unacceptable in Starfleet."});}
allAnswers.sort(()=>Math.random()-0.5);
allAnswers.forEach(a=>{
const btn=document.createElement("button");
btn.textContent=a.text;
btn.onclick=()=>evaluate(a,q);
answersDiv.appendChild(btn);
});
content.appendChild(answersDiv);
}
function evaluate(ans,q){
document.querySelectorAll("#examContent .answers button").forEach(b=>b.disabled=true);
const best=q.answers.find(a=>a.type==="best");
const feedback=document.createElement("div");
if(ans.type==="best"){feedback.innerHTML=`<strong>Correct.</strong> ${ans.details}`;total+=ans.score;}
else if(ans.type==="alternate"){feedback.innerHTML=`<strong>Acceptable.</strong> ${ans.details}<br><br>The best answer was:<br><em>${best.text}</em>`;total+=ans.score;}
else{feedback.innerHTML=`<strong>Incorrect.</strong> ${ans.details}<br><br>The correct response was:<br><em>${best.text}</em>`;}
content.appendChild(feedback);
const gpa=(total/((index+1)*10)*4).toFixed(2);
classmates.find(c=>c.s).gpa=gpa;
updateRankings();
const next=document.createElement("button");
next.textContent=index<questions.length-1?"Next Question":"Finish Exam";
next.onclick=()=>{index++;if(index<questions.length){renderQuestion();}else{content.innerHTML=`<h3>Exam Complete</h3><p>Your total score: ${total}<br>Your final GPA: ${gpa}</p>`;}};
content.appendChild(next);
}
renderQuestion();
});
}

document.getElementById("returnMain").onclick=()=>{document.getElementById("orientationPage").style.display="none";document.getElementById("mainScreen").style.display="block";};
document.getElementById("returnOrientation1").onclick=()=>{document.getElementById("trainingPage").style.display="none";document.getElementById("orientationPage").style.display="block";};
document.getElementById("returnOrientation2").onclick=()=>{document.getElementById("labPage").style.display="none";document.getElementById("orientationPage").style.display="block";};
document.getElementById("returnOrientation3").onclick=()=>{document.getElementById("examPage").style.display="none";document.getElementById("orientationPage").style.display="block";};
</script>
</body>
</html>
  <div id="trainingPage" style="display:none;">
    <div class="page-title" id="trainingDeptTitle"></div>
    <div style="text-align:center;color:var(--gold);margin-bottom:10px;" id="trainingCadetTitle"></div>
    <div class="container" id="trainingContent"></div>
    <button class="return-btn fixed-return" id="returnOrientation1">Back to Departments</button>
  </div>

  <div id="labPage" style="display:none;">
    <div class="page-title" id="labDeptTitle"></div>
    <div style="text-align:center;color:var(--gold);margin-bottom:10px;" id="labCadetTitle"></div>
    <div class="container" id="labContent"></div>
    <button class="return-btn fixed-return" id="returnOrientation2">Back to Departments</button>
  </div>

  <div id="examPage" style="display:none;">
    <div class="page-title" id="examDeptTitle"></div>
    <div style="text-align:center;color:var(--gold);margin-bottom:10px;" id="examCadetTitle"></div>

    <div id="examScoreboard">
      <h3>Class Rankings</h3>
      <table id="rankingTable"></table>
    </div>

    <div class="container" id="examContent"></div>
    <button class="return-btn fixed-return" id="returnOrientation3">Back to Departments</button>
  </div>

  <script>
    let cadetName = "", species = "", homeworld = "";

    document.getElementById("loginBtn").onclick = () => {
      cadetName = document.getElementById("cadetName").value.trim();
      species = document.getElementById("species").value.trim();
      if (!cadetName || !species) return;

      const homeworlds = {
        "Human": "Earth",
        "Vulcan": "Vulcan",
        "Andorian": "Andoria",
        "Tellarite": "Tellar Prime",
        "Bajoran": "Bajor",
        "Betazoid": "Betazed",
        "Bolian": "Bolarus IX",
        "Trill": "Trill",
        "Klingon": "Qo'noS",
        "Ferengi": "Ferenginar",
        "Denobulan": "Denobula",
        "Orion": "Orion",
        "Caitian": "Cait",
        "Benzite": "Benzar"
      };

      homeworld = homeworlds[species] || species;
      const msg = document.getElementById("accessMessage");
      msg.textContent = `Access Granted — Welcome, Cadet ${cadetName} of ${homeworld}`;
      msg.style.opacity = 1;

      const login = document.getElementById("loginScreen");
      login.style.transition = "opacity 3s ease";
      login.style.opacity = 0;
      setTimeout(() => {
        login.style.display = "none";
        document.getElementById("mainScreen").style.display = "block";
      }, 3000);
    };

    document.getElementById("trainingBtn").onclick = () => showOrientation("training");
    document.getElementById("labBtn").onclick = () => showOrientation("lab");
    document.getElementById("examBtn").onclick = () => showOrientation("exam");

    const trainingFiles = {
      "Command": "https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Command%20Training.json",
      "Diplomacy": "https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Diplomacy%20Training.json",
      "Engineering": "https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Engineering%20Training.json",
      "Security": "https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Security%20Training.json",
      "Science": "https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Science%20Training.json",
      "Medical": "https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Medical%20Training.json"
    };

    const labFiles = {
      "Command": "https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Command%20Lab.json",
      "Diplomacy": "https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Diplomacy%20Lab.json",
      "Engineering": "https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Engineering%20Lab.json",
      "Security": "https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Security%20Lab.json",
      "Science": "https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Science%20Lab.json",
      "Medical": "https://raw.githubusercontent.com/BigBird7827/Starfleet_Academy/main/Medical%20Lab.json"
    };

    function showOrientation(mode) {
      document.getElementById("mainScreen").style.display = "none";
      document.getElementById("orientationPage").style.display = "block";

      const title = document.getElementById("orientationTitle");
      title.textContent = mode === "training"
        ? "Training Modules"
        : mode === "lab"
        ? "Laboratories"
        : "Examinations";

      const box = document.getElementById("moduleButtons");
      box.innerHTML = "";

      Object.keys(trainingFiles).forEach(dept => {
        const b = document.createElement("button");
        b.textContent = dept;
        b.onclick = () => {
          if (mode === "training") loadTraining(dept);
          else if (mode === "lab") loadLab(dept);
          else loadExam(dept);
        };
        box.appendChild(b);
      });
    }

    function loadTraining(dept) {
      document.getElementById("orientationPage").style.display = "none";
      document.getElementById("trainingPage").style.display = "block";
      document.getElementById("trainingDeptTitle").textContent = `${dept} Training`;
      document.getElementById("trainingCadetTitle").textContent = `Cadet ${cadetName} of ${homeworld}`;

      fetch(trainingFiles[dept])
        .then(r => r.json())
        .then(data => {
          const content = document.getElementById("trainingContent");
          content.innerHTML = "";

          if (data.preface) content.innerHTML += `<p>${data.preface}</p>`;

          if (data.study) {
            data.study.forEach(item => {
              const section = document.createElement("div");
              section.className = "training-section";

              let html = `<h3>${item.scenario}</h3><p>${item.summary || ""}</p>`;

              if (item.answers) {
                html += `<div class="answers">`;
                item.answers.forEach(ans => {
                  const label = ans.type === "best" ? "⭐ Best Answer" : "Alternate Answer";
                  html += `
                    <div class="answer-block">
                      <p><strong>${label}:</strong> ${ans.text}</p>
                      <p><em>Score:</em> ${ans.score}</p>
                      <p>${ans.details || ""}</p>
                    </div>
                  `;
                });
                html += `</div>`;
              }

              section.innerHTML = html;
              content.appendChild(section);
            });
          }
        });
    }
    function loadLab(dept) {
      document.getElementById("orientationPage").style.display = "none";
      document.getElementById("labPage").style.display = "block";
      document.getElementById("labDeptTitle").textContent = `${dept} Lab`;
      document.getElementById("labCadetTitle").textContent = `Cadet ${cadetName} of ${homeworld}`;

      fetch(labFiles[dept])
        .then(r => r.json())
        .then(data => {
          const content = document.getElementById("labContent");
          content.innerHTML = "";

          if (!(data.lab && data.lab.length)) {
            content.innerHTML = "<p>No lab scenarios found.</p>";
            return;
          }

          let index = 0, score = 0;

          function renderScenario() {
            const item = data.lab[index];
            content.innerHTML = `
              <div class='training-section'>
                <h3>${item.scenario}</h3>
                <p>${item.summary || ""}</p>
              </div>
            `;

            const answersDiv = document.createElement("div");
            answersDiv.className = "answers";

            item.answers.forEach(ans => {
              const btn = document.createElement("button");
              btn.textContent = ans.text;
              btn.onclick = () => evaluate(ans, item);
              answersDiv.appendChild(btn);
            });

            content.appendChild(answersDiv);
          }

          function evaluate(ans, item) {
            document.querySelectorAll("#labContent .answers button").forEach(b => (b.disabled = true));
            const best = item.answers.find(a => a.type === "best");

            const feedback = document.createElement("div");
            feedback.className = "feedback";

            if (ans.type === "best") {
              feedback.innerHTML = `<strong>Correct.</strong> ${ans.details}`;
              score += ans.score;
            } else if (ans.type === "alternate") {
              feedback.innerHTML = `
                <strong>Acceptable.</strong> ${ans.details}<br><br>
                The best action would have been:<br><em>${best.text}</em>
              `;
              score += ans.score;
            } else {
              feedback.innerHTML = `
                <strong>Incorrect.</strong> ${ans.details}<br><br>
                The correct course of action:<br><em>${best.text}</em>
              `;
            }

            content.appendChild(feedback);

            const next = document.createElement("button");
            next.textContent = index < data.lab.length - 1 ? "Next Scenario" : "Finish Lab";
            next.onclick = () => {
              index++;
              if (index < data.lab.length) {
                renderScenario();
              } else {
                content.innerHTML = `<h3>Lab Complete</h3><p>Your final score: ${score}</p>`;
              }
            };
            content.appendChild(next);
          }

          renderScenario();
        });
    }

    function loadExam(dept) {
      document.getElementById("orientationPage").style.display = "none";
      document.getElementById("examPage").style.display = "block";
      document.getElementById("examDeptTitle").textContent = `${dept} Exam`;
      document.getElementById("examCadetTitle").textContent = `Cadet ${cadetName} of ${homeworld}`;

      let classmates = [{ name: cadetName, species, s: true, gpa: 0, score: 0 }];
      const poolNames = ["T'Lor", "Dax", "Nog", "Paris", "Vorik", "Ro", "O'Brien", "Leeta", "Torres"];
      const poolSpecies = ["Vulcan", "Trill", "Ferengi", "Human", "Vulcan", "Bajoran", "Human", "Bajoran", "Klingon"];

      for (let i = 0; i < 9; i++) {
        classmates.push({
          name: poolNames[i],
          species: poolSpecies[i],
          s: false,
          gpa: (Math.random() * 1.6 + 2.4).toFixed(2),
          score: 0
        });
      }

      const table = document.getElementById("rankingTable");

      function updateRankings() {
        classmates.sort((a, b) => b.gpa - a.gpa);
        table.innerHTML = classmates
          .map(
            (c, i) =>
              `<tr class='${c.s ? "highlight" : ""}'><td>${i + 1}.</td><td>${c.s ? "You" : c.name}</td><td>${parseFloat(
                c.gpa
              ).toFixed(2)}</td></tr>`
          )
          .join("");
      }

      updateRankings();

      fetch(trainingFiles[dept])
        .then(r => r.json())
        .then(data => {
          const questions = data.study.slice(0, 15);
          let index = 0,
            total = 0;
          const content = document.getElementById("examContent");

          function renderQuestion() {
            const q = questions[index];
            content.innerHTML = `
              <div class='training-section'>
                <h3>${q.scenario}</h3>
                <p>${q.summary || ""}</p>
              </div>
            `;

            const answersDiv = document.createElement("div");
            answersDiv.className = "answers";

            let allAnswers = [...q.answers];

            if (allAnswers.length < 5) {
              allAnswers.push({
                text: "Reroute main deflector through EPS grid.",
                score: 0,
                type: "wrong",
                details: "This course of action would destabilize the system."
              });
              allAnswers.push({
                text: "Ignore the situation and await orders.",
                score: 0,
                type: "wrong",
                details: "Inaction in crisis situations is unacceptable in Starfleet."
              });
            }

            allAnswers.sort(() => Math.random() - 0.5);

            allAnswers.forEach(a => {
              const btn = document.createElement("button");
              btn.textContent = a.text;
              btn.onclick = () => evaluate(a, q);
              answersDiv.appendChild(btn);
            });

            content.appendChild(answersDiv);
          }

          function evaluate(ans, q) {
            document.querySelectorAll("#examContent .answers button").forEach(b => (b.disabled = true));
            const best = q.answers.find(a => a.type === "best");

            const feedback = document.createElement("div");

            if (ans.type === "best") {
              feedback.innerHTML = `<strong>Correct.</strong> ${ans.details}`;
              total += ans.score;
            } else if (ans.type === "alternate") {
              feedback.innerHTML = `
                <strong>Acceptable.</strong> ${ans.details}<br><br>
                The best answer was:<br><em>${best.text}</em>
              `;
              total += ans.score;
            } else {
              feedback.innerHTML = `
                <strong>Incorrect.</strong> ${ans.details}<br><br>
                The correct response was:<br><em>${best.text}</em>
              `;
            }

            content.appendChild(feedback);

            const gpa = ((total / ((index + 1) * 10)) * 4).toFixed(2);
            classmates.find(c => c.s).gpa = gpa;
            updateRankings();

            const next = document.createElement("button");
            next.textContent = index < questions.length - 1 ? "Next Question" : "Finish Exam";
            next.onclick = () => {
              index++;
              if (index < questions.length) {
                renderQuestion();
              } else {
                content.innerHTML = `
                  <h3>Exam Complete</h3>
                  <p>Your total score: ${total}<br>Your final GPA: ${gpa}</p>
                `;
              }
            };
            content.appendChild(next);
          }

          renderQuestion();
        });
    }

    document.getElementById("returnMain").onclick = () => {
      document.getElementById("orientationPage").style.display = "none";
      document.getElementById("mainScreen").style.display = "block";
    };

    document.getElementById("returnOrientation1").onclick = () => {
      document.getElementById("trainingPage").style.display = "none";
      document.getElementById("orientationPage").style.display = "block";
    };

    document.getElementById("returnOrientation2").onclick = () => {
      document.getElementById("labPage").style.display = "none";
      document.getElementById("orientationPage").style.display = "block";
    };

    document.getElementById("returnOrientation3").onclick = () => {
      document.getElementById("examPage").style.display = "none";
      document.getElementById("orientationPage").style.display = "block";
    };
  </script>
</body>
</html>
